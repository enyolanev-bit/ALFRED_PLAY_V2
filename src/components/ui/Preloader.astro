---
/**
 * Preloader — Écran de chargement animé.
 * - Fond noir plein écran, z-index 9999
 * - "ALFRED" s'écrit lettre par lettre (GSAP stagger)
 * - "PLAY" apparaît en rouge accent
 * - "1960 → 2026" fade-in
 * - Slide vers le haut quand le site est prêt (window load + fonts)
 */
---

<div class="preloader" id="preloader" aria-hidden="true">
  <div class="preloader__content">
    <div class="preloader__title" id="preloader-title">
      <span class="preloader__letter" data-preloader-letter>A</span>
      <span class="preloader__letter" data-preloader-letter>L</span>
      <span class="preloader__letter" data-preloader-letter>F</span>
      <span class="preloader__letter" data-preloader-letter>R</span>
      <span class="preloader__letter" data-preloader-letter>E</span>
      <span class="preloader__letter" data-preloader-letter>D</span>
    </div>
    <div class="preloader__play" id="preloader-play">PLAY</div>
    <div class="preloader__dates" id="preloader-dates">1960 → 2026</div>
  </div>
</div>

<script>
  import gsap from 'gsap';

  function initPreloader() {
    const preloader = document.getElementById('preloader');
    const letters = document.querySelectorAll('[data-preloader-letter]');
    const play = document.getElementById('preloader-play');
    const dates = document.getElementById('preloader-dates');

    if (!preloader || !letters.length || !play || !dates) return;

    // Timeline d'animation du preloader
    const tl = gsap.timeline();

    // 1. Lettres de "ALFRED" — stagger 0.1s
    tl.to(letters, {
      opacity: 1,
      y: 0,
      duration: 0.4,
      stagger: 0.1,
      ease: 'power3.out',
    });

    // 2. "PLAY" apparaît en rouge
    tl.to(play, {
      opacity: 1,
      y: 0,
      duration: 0.5,
      ease: 'power3.out',
    }, '-=0.1');

    // 3. "1960 → 2026" fade-in
    tl.to(dates, {
      opacity: 1,
      duration: 0.6,
      ease: 'power2.out',
    }, '-=0.2');

    // Quand le site est chargé (window load + fonts), slide le preloader vers le haut
    const dismiss = () => {
      // Petit délai pour laisser le temps de voir l'animation complète
      gsap.to(preloader, {
        yPercent: -100,
        duration: 0.8,
        ease: 'power3.inOut',
        delay: 0.3,
        onComplete: () => {
          preloader.remove();
        },
      });
    };

    // Attendre à la fois window.load ET document.fonts.ready
    Promise.all([
      new Promise((resolve) => {
        if (document.readyState === 'complete') {
          resolve();
        } else {
          window.addEventListener('load', resolve, { once: true });
        }
      }),
      document.fonts.ready,
    ]).then(dismiss);
  }

  // Lancer immédiatement (le preloader est dans le DOM dès le début)
  initPreloader();
</script>

<style>
  .preloader {
    position: fixed;
    inset: 0;
    z-index: 99999;
    background: #0A0A0A;
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: all;
  }

  .preloader__content {
    text-align: center;
  }

  .preloader__title {
    display: flex;
    justify-content: center;
    gap: 0.08em;
    margin-bottom: 0.3em;
  }

  .preloader__letter {
    font-family: var(--font-display, 'Space Grotesk', sans-serif);
    font-size: clamp(3rem, 8vw, 6rem);
    font-weight: 700;
    color: var(--color-text-primary, #F5F5F7);
    opacity: 0;
    transform: translateY(20px);
    display: inline-block;
    letter-spacing: 0.05em;
  }

  .preloader__play {
    font-family: var(--font-display, 'Space Grotesk', sans-serif);
    font-size: clamp(1.5rem, 4vw, 2.5rem);
    font-weight: 600;
    color: var(--color-accent, #E63946);
    opacity: 0;
    transform: translateY(15px);
    letter-spacing: 0.3em;
    text-transform: uppercase;
    margin-bottom: 1.5em;
  }

  .preloader__dates {
    font-family: var(--font-body, 'Plus Jakarta Sans', sans-serif);
    font-size: clamp(0.85rem, 2vw, 1.1rem);
    font-weight: 400;
    color: var(--color-text-muted, #48484A);
    opacity: 0;
    letter-spacing: 0.15em;
  }
</style>
